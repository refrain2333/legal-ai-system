# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## CLAUDE.mdç¼–å†™è§„åˆ™

**é‡è¦ï¼šæ­¤æ–‡ä»¶ä»…åŒ…å«AIå¼€å‘æŒ‡å¯¼çš„å…³é”®ä¿¡æ¯ï¼Œç¦æ­¢æ·»åŠ ä»¥ä¸‹å†…å®¹**ï¼š
- è¯¦ç»†çš„å®‰è£…æ­¥éª¤ï¼ˆåº”åœ¨README.mdä¸­ï¼‰
- å®Œæ•´çš„APIæ–‡æ¡£ï¼ˆåº”åœ¨docs/api/ä¸­ï¼‰
- é¡¹ç›®ä»‹ç»å’ŒèƒŒæ™¯ï¼ˆåº”åœ¨README.mdä¸­ï¼‰
- ç”¨æˆ·æ‰‹å†Œå†…å®¹ï¼ˆåº”åœ¨docs/user/ä¸­ï¼‰

**æ­¤æ–‡ä»¶ä¸“æ³¨äº**ï¼š
- æ ¸å¿ƒæ¶æ„å’ŒæŠ€æœ¯å†³ç­–
- AIå¼€å‘çš„å…³é”®æŒ‡å¯¼
- ä»£ç çº¦å®šå’Œæœ€ä½³å®è·µ
- å¼€å‘å·¥ä½œæµç¨‹

---

## é¡¹ç›®æ ¸å¿ƒ

**æ³•æ™ºå¯¼èˆª** - æ™ºèƒ½æ³•å¾‹æ£€ç´¢ç³»ç»Ÿ
**æ ¸å¿ƒæŠ€æœ¯**ï¼šFastAPI + sentence-transformers + numpy + asyncio
**æ¶æ„æ¨¡å¼**ï¼šåˆ†å±‚æ¶æ„ (API â†’ Services â†’ AI Models â†’ Data)
**å½“å‰ç‰ˆæœ¬**ï¼šv0.3.1 (ç¬¬äºŒé˜¶æ®µå®Œæˆ)

## å…³é”®å¼€å‘å‘½ä»¤

```bash
# ç¯å¢ƒå‡†å¤‡ï¼ˆä»…é¦–æ¬¡ï¼‰
conda activate legal-ai  # æ¿€æ´»condaç¯å¢ƒ
pip install -r requirements_fixed.txt  # å®‰è£…ä¾èµ–

# ç³»ç»ŸéªŒè¯
python verify_system_structure.py  # éªŒè¯ç³»ç»Ÿç»“æ„

# å¼€å‘æœåŠ¡å™¨
python src/main.py  # http://localhost:5005

# ä»£ç è´¨é‡
black src/ tests/ && pylint src/ && pytest
```

## AIæ¨¡å‹æ¶æ„

### è¯­ä¹‰æ£€ç´¢æµæ°´çº¿ (v0.3.1)
1. **æ–‡æœ¬å‘é‡åŒ–**: shibing624/text2vec-base-chinese (768ç»´è¯­ä¹‰å‘é‡)
2. **ç´¢å¼•æ„å»º**: numpyå‘é‡æ•°ç»„ + å†…ç§¯ç›¸ä¼¼åº¦è®¡ç®—
3. **æ£€ç´¢æ’åº**: çº¯è¯­ä¹‰ç›¸ä¼¼åº¦æ’åº

### å…³é”®é…ç½®
```python
# src/models/semantic_embedding.py
MODEL_NAME = "shibing624/text2vec-base-chinese"
EMBEDDING_DIM = 768
MAX_SEQUENCE_LENGTH = 128  # ä¼˜åŒ–åé•¿åº¦
BATCH_SIZE = 32  # æ‰¹å¤„ç†å¤§å°
```

### æ•°æ®æ¨¡å‹
```python
# å®Œæ•´è¯­ä¹‰ç´¢å¼•ç»“æ„
{
    'vectors': np.ndarray,  # (3519, 768) è¯­ä¹‰å‘é‡çŸ©é˜µ
    'metadata': List[Dict],  # æ–‡æ¡£å…ƒæ•°æ®
    'model_info': Dict      # æ¨¡å‹ä¿¡æ¯
}
```

## ä»£ç æ¶æ„

### å…³é”®ç›®å½• (ç¬¬äºŒé˜¶æ®µå®Œæˆ)
- `src/models/`: **semantic_embedding.py** (768ç»´è¯­ä¹‰æ¨¡å‹)
- `src/data/`: **full_dataset_processor.py** (3,519æ–‡æ¡£å¤„ç†)
- `src/services/`: **retrieval_service.py** (v0.3.0è¯­ä¹‰æœåŠ¡)
- `src/api/`: FastAPIè·¯ç”± (å‘åå…¼å®¹)
- `src/config/`: Pydanticé…ç½®ç®¡ç†

### é¡¹ç›®ç»“æ„è§„èŒƒ
- **ç›¸å¯¹å¯¼å…¥**: ä½¿ç”¨ `from ..models.semantic_embedding import SemanticTextEmbedding`
- **æ¨¡å—åˆ†ç¦»**: models/data/services/api åŠŸèƒ½æ¸…æ™°åˆ†ç¦»
- **æ— sys.path**: ç¦æ­¢ä½¿ç”¨ `sys.path.append()` ç¡¬ç¼–ç è·¯å¾„

## å¼€å‘çŠ¶æ€

**âœ… ç¬¬äºŒé˜¶æ®µå·²å®Œæˆ (v0.3.1)**:
- å¤§è§„æ¨¡æ•°æ®å¤„ç† (3,519ä¸ªæ–‡æ¡£)
- è¯­ä¹‰å‘é‡æ£€ç´¢ç³»ç»Ÿ (sentence-transformers)
- é«˜æ€§èƒ½æœåŠ¡ (47mså¹³å‡å“åº”æ—¶é—´)
- é¡¹ç›®ç»“æ„ä¼˜åŒ– (æ ‡å‡†å¯¼å…¥è·¯å¾„)
- å‘åå…¼å®¹API (å®Œå…¨å…¼å®¹v0.2.0)

**ğŸ“Š å…³é”®æŒ‡æ ‡**:
- æ–‡æ¡£æ•°é‡: **3,519ä¸ª** (æ³•æ¡+æ¡ˆä¾‹)
- ç›¸ä¼¼åº¦è´¨é‡: **0.6-0.8** (vs åŸ0.1-0.2)
- å“åº”æ—¶é—´: **47mså¹³å‡**
- å‘é‡ç»´åº¦: **768ç»´æ ‡å‡†**

**ğŸ¯ ç”Ÿäº§å°±ç»ª**: ç³»ç»Ÿå·²è¾¾åˆ°ç”Ÿäº§çº§åˆ«æ€§èƒ½å’Œç¨³å®šæ€§

## æ•°æ®æ–‡ä»¶è¯´æ˜

**å¤„ç†å®Œæˆçš„æ•°æ®** (v0.3.1):
- `data/processed/full_dataset.pkl` - 3,519ä¸ªæ–‡æ¡£ (1.9MB)
- `data/indices/complete_semantic_index.pkl` - è¯­ä¹‰ç´¢å¼• (11.2MB)

**åŸå§‹æ•°æ®** (`./data/raw/`):
- `raw_laws(1).csv` - æ³•å¾‹æ¡æ–‡ (1.3MB)
- `raw_cases(1).csv` - æ¡ˆä¾‹æ•°æ® (16.5MB)

## å…³é”®æ³¨æ„äº‹é¡¹

- **ç¯å¢ƒ**: condaç¯å¢ƒ `legal-ai` å¿…éœ€
- **å†…å­˜éœ€æ±‚**: ~2GB (æ¨¡å‹åŠ è½½)
- **å¯¼å…¥è§„èŒƒ**: ä½¿ç”¨ç›¸å¯¹å¯¼å…¥ï¼Œé¿å…sys.path
- **å¼‚æ­¥ä¼˜å…ˆ**: æ‰€æœ‰IOæ“ä½œä½¿ç”¨async
- **ç‰ˆæœ¬å…¼å®¹**: å®Œå…¨å‘åå…¼å®¹APIæ¥å£