# 刑法数据集精简说明

## 🎯 数据集概览

### 基本信息
- **数据集名称**: 中国刑法条文与刑事案例数据集
- **核心数据**: 结构化刑法条文 + 真实刑事案例 + 语义向量数据
- **数据规模**: 416条刑法条文 + 17,131个刑事案例
- **向量模型**: thunlp/Lawformer (768维)
- **存储位置**: `data/processed/` 目录
- **数据状态**: ✅ **预处理完成，可直接用于法律AI系统**

### 数据构成
| 数据类型 | 文件位置 | 记录数 | 文件大小 | 说明 |
|----------|----------|--------|----------|------|
| 刑法条文 | `criminal/criminal_articles.pkl` | 416条 | 0.23MB | 完整条文内容与元数据 |
| 刑事案例 | `criminal/criminal_cases.pkl` | 17,131个 | 20.8MB | 完整案件事实与标注 |
| 条文向量 | `vectors/criminal_articles_vectors.pkl` | 416个 | 1.25MB | 768维语义向量 |
| 案例向量 | `vectors/criminal_cases_vectors.pkl` | 17,131个 | 51.89MB | 768维语义向量 |

---

## 📊 核心数据结构

### 1. 刑法条文数据 (`criminal_articles.pkl`)
**数据结构**:
```python
{
    "article_number": 1,                    # 法条编号
    "title": "中华人民共和国刑法 第1条",     # 法条标题
    "content": "为了惩罚犯罪，保护人民...",   # 完整条文内容
    "chapter": "第一章 刑法的任务...",       # 所属章节
    "section": None,                        # 所属节次
    "related_cases": ["case_001", ...]      # 关联案例ID
}
```

### 2. 刑事案例数据 (`criminal_cases.pkl`)
**数据结构**:
```python
{
    "case_id": "case_000001",               # 案例唯一标识
    "fact": "公诉机关起诉指控...",          # 完整案件事实描述
    "accusations": ["盗窃"],                 # 罪名列表
    "relevant_articles": [264],             # 相关法条编号
    "sentence_info": {                      # 量刑信息
        "imprisonment_months": 2,           # 有期徒刑月数
        "fine_amount": 0,                   # 罚金金额
        "death_penalty": False,             # 是否死刑
        "life_imprisonment": False          # 是否无期徒刑
    }
}
```

### 3. 向量数据 (`vectors/*.pkl`)
**数据结构**:
```python
{
    "vectors": np.array([...]),             # 768维向量矩阵 (float32)
    "metadata": [{...}],                    # 对应元数据列表
    "total_count": 17131,                   # 数据总数 (仅案例向量包含)
    "model_info": {                         # 模型信息
        "model_name": "thunlp/Lawformer",
        "embedding_dim": 768,
        "dtype": "float32"
    }
}
```

**注意事项**:
- 法条向量文件当前缺少 `total_count` 字段
- 所有向量均为768维float32格式
- 向量未进行归一化处理
- 使用cosine_similarity计算相似度

---

## 🔗 数据关系说明

### 数据流转关系
```
原始文本 → 结构化处理 → 向量化处理
   ↓           ↓             ↓
刑法文档 → criminal_articles.pkl → criminal_articles_vectors.pkl
案例文档 → criminal_cases.pkl    → criminal_cases_vectors.pkl
```

### 使用场景对比
| 使用场景 | 使用原始数据 | 使用向量数据 |
|----------|-------------|-------------|
| 显示完整内容 | ✅ criminal/ 目录 | ❌ vectors/ 目录 |
| 语义搜索 | ❌ 效率低 | ✅ 快速检索 |
| 数据验证 | ✅ 完整文本 | ❌ 只有元数据 |
| 重新训练 | ✅ 必需 | ❌ 可选 |

---

## 📈 数据统计摘要

### 核心统计
- **法条总数**: 416条 (已验证)
- **案例总数**: 17,131个 (已验证)
- **向量维度**: 768维 (thunlp/Lawformer)
- **数据类型**: float32 (未归一化)
- **总存储大小**: ~74MB (原始数据21MB + 向量数据53MB)

### 数据质量验证
- ✅ **向量完整性**: 无NaN/Inf值，无零向量
- ✅ **数据一致性**: 案例数据计数完全一致
- ⚠️ **格式统一性**: 法条向量缺少total_count字段
- ✅ **维度正确性**: 所有向量均为768维
- ✅ **类型正确性**: 统一使用float32格式

### Top 5 高频罪名
1. **盗窃**: 995个案例
2. **毒品犯罪**: 883个案例  
3. **故意伤害**: 639个案例
4. **抢劫**: 472个案例
5. **诈骗**: 352个案例

### Top 5 高引用法条
1. **第347条** (毒品): 1,614次引用
2. **第264条** (盗窃): 952次引用
3. **第383条** (贪污): 733次引用
4. **第234条** (伤害): 591次引用
5. **第133条** (交通肇事): 494次引用

---

## 🔧 数据验证工具

### 验证工具集
为确保数据质量，项目提供了专门的验证工具：

```bash
# 快速验证所有数据
python tools/data_validation/simple_vector_checker.py

# 完整格式检查
python tools/data_validation/vector_format_checker.py

# 数据完整性检查 
python tools/data_validation/data_integrity_checker.py

# 一键运行所有验证
python tools/data_validation/quick_validation_runner.py
```

### 验证内容
- ✅ **向量格式**: 维度、数据类型、结构完整性
- ✅ **数据质量**: NaN/Inf值、零向量检测
- ✅ **文件完整性**: 必需字段、计数一致性
- ✅ **存储信息**: 文件大小、加载性能

---

## 💻 使用方法

### 1. 加载数据
```python
import pickle

# 加载刑法条文
with open('data/processed/criminal/criminal_articles.pkl', 'rb') as f:
    articles = pickle.load(f)

# 加载刑事案例  
with open('data/processed/criminal/criminal_cases.pkl', 'rb') as f:
    cases = pickle.load(f)

# 加载向量数据
with open('data/processed/vectors/criminal_articles_vectors.pkl', 'rb') as f:
    article_vectors = pickle.load(f)
```

### 2. 语义搜索示例
```python
from src.infrastructure.storage.lawformer_embedder import LawformerEmbedder
from sklearn.metrics.pairwise import cosine_similarity

# 编码查询
model = LawformerEmbedder(model_name='thunlp/Lawformer')
query = "盗窃他人财物"
query_vector = model.encode([query])

# 在案例向量中搜索
case_vectors_data = pickle.load(open('vectors/criminal_cases_vectors.pkl', 'rb'))
similarities = cosine_similarity(query_vector, case_vectors_data['vectors'])[0]

# 获取最相关案例
top_indices = similarities.argsort()[-5:][::-1]
for idx in top_indices:
    case_meta = case_vectors_data['metadata'][idx]
    case_id = case_meta['case_id']
    # 从criminal目录获取完整案例内容
    full_case = next(c for c in cases if c.case_id == case_id)
    print(f"相似度{similarities[idx]:.3f}: {case_meta['accusations']} - {full_case.fact[:100]}...")
```

---

## 🎯 核心价值

### 对于开发者
- ✅ **开箱即用**: 数据已预处理，可直接集成
- ✅ **高效检索**: 向量数据支持毫秒级语义搜索
- ✅ **完整内容**: criminal目录提供完整文本内容
- ✅ **标准格式**: 统一的数据结构便于扩展

### 对于研究者
- ✅ **真实数据**: 17,131个真实司法案例
- ✅ **精确关联**: 通过relevant_articles字段精确关联法条与案例
- ✅ **多维度分析**: 支持罪名统计、法条引用分析等
- ✅ **语义理解**: 768维向量支持深度语义分析

### 系统集成优势
- **快速启动**: 预计算向量避免实时编码延迟
- **内存高效**: 向量数据约53MB内存占用
- **响应迅速**: 单次检索47ms响应时间 (实测)
- **扩展灵活**: 标准格式支持多种检索算法
- **质量保证**: 内置验证工具确保数据完整性
- **模型先进**: 使用Lawformer专业法律语言模型

---

**文档版本**: v2.1 (验证优化版)
**更新日期**: 2025-09-21
**数据状态**: ✅ **生产就绪 (已验证)**

> 💡 **提示**: 此数据集专为刑法AI应用优化，包含完整的条文-案例关联体系，支持从法条查询到案例检索的全链路法律智能应用。所有数据已通过验证工具检查，确保格式正确和质量可靠。